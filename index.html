<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Log Use of Applications and Reports at Rapporteket • raplog</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Log Use of Applications and Reports at Rapporteket">
<meta property="og:description" content="Keeps record of acitivity initiated by users of Rapporteket such
  as start of shiny sessions and single report requests. This package also
  deals with file operations such as creation, archiving and deletion of log
  files.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">raplog</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Rapporteket/raplog">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="contents col-md-9">
<div id="raplog" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#raplog" class="anchor"></a>raplog</h1></div>
<!-- badges: start -->

<p>raplog provides logging for registries and underlying reports at Rapporteket. The purpose of raplog is NOT logging of how your code works (<em>e.g.</em> for code debugging) but rather the use of reports (statistics and auditing).</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the released version of raplog from <a href="https://github.com/Rapporteket">Rapporteket at GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">remotes<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/remotes/topics/install_github">install_github</a></span>(<span class="st">"Rapporteket/raplog"</span>)</a></code></pre></div>
</div>
<div id="use" class="section level2">
<h2 class="hasAnchor">
<a href="#use" class="anchor"></a>Use</h2>
<p>raplog collects information from three sources:</p>
<ol>
<li>the R environment; from where and which function the call (for logging) comes from,</li>
<li>the shiny session object; user details in the shiny session from where logging is requested, and</li>
<li>an optional message to be part of the log</li>
</ol>
<p>A typical usecase will call one out of two functions in raplog; <code><a href="reference/logger.html">appLogger()</a></code> for logging at the shiny application level and <code><a href="reference/logger.html">repLogger()</a></code> for logging at the report level.</p>
<p>To make a log entry when the shiny application “smerteregistert” starts, use <code><a href="reference/logger.html">raplog::appLogger()</a></code> in the shiny server function:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(shiny)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(raplog)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">  raplog<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/raplog/topics/logger">appLogger</a></span>(session, <span class="dt">msg =</span> <span class="st">"Smerteregisteret: starting shiny app"</span>)</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb2-8" data-line-number="8">  ...</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">  </a>
<a class="sourceLine" id="cb2-10" data-line-number="10">}</a></code></pre></div>
<p>This will add a record to the application log that may look like:</p>
<pre class="csv"><code>"time","user","name","group","role","resh_id","message"
"2019-08-12 10:55:38","ttester","Tore Tester","smerte","LU",999999,"Smerteregisteret: starting shiny app"</code></pre>
<p>To log the use of single reports (<em>e.g.</em> figures, tables, documents) use <code><a href="reference/logger.html">raplog::repLogger()</a></code> within a reactive context in the server function:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(shiny)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(raplog)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">...</a>
<a class="sourceLine" id="cb4-7" data-line-number="7"></a>
<a class="sourceLine" id="cb4-8" data-line-number="8">  output<span class="op">$</span>hist &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/shiny/topics/renderPlot">renderPlot</a></span>({</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">    raplog<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/raplog/topics/logger">repLogger</a></span>(session, <span class="dt">msg =</span> <span class="st">"Smerteregisteret: providing histogram"</span>)</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">    <span class="kw">makeHist</span>(<span class="dt">df =</span> regData, <span class="dt">var =</span> input<span class="op">$</span>var, <span class="dt">bins =</span> input<span class="op">$</span>bins)</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">    ...</a>
<a class="sourceLine" id="cb4-12" data-line-number="12">  })</a>
<a class="sourceLine" id="cb4-13" data-line-number="13">  ...</a>
<a class="sourceLine" id="cb4-14" data-line-number="14">}</a></code></pre></div>
<p>This will add a record to the report log that may look like:</p>
<pre class="csv"><code>"time","user","name","group","role","resh_id","environment","call","message"
"2019-08-12 10:55:41","ttester","Tore Tester","smerteregisteret","LU",999999,"R_GlobalEnv","renderPlot(...)","Smerteregisteret: providing histogram"</code></pre>
</div>
<div id="improved-report-logging" class="section level2">
<h2 class="hasAnchor">
<a href="#improved-report-logging" class="anchor"></a>Improved report logging</h2>
<p>From the last example above the log states that it was called from <code><a href="https://www.rdocumentation.org/packages/shiny/topics/renderPlot">renderPlot(...)</a></code> residing in the R global environment (<code>R_GlobalEnv</code>). The log fields <em>environment</em> and <em>call</em> would be much more useful if they provided more details on the actual function call that produces the report and the package (environment) that the registry belongs to. The latter would provide the oportunity to check wether the login credentials (as provided in the log fields <em>user</em>, <em>name</em>, <em>group</em>, <em>role</em>, and <em>resh_id</em>) match the actual call for the report or not (in case we have a possible breach of confidentiality). This can be obtained by moving <code><a href="reference/logger.html">repLogger()</a></code> from the shiny reactive function into the function that actually produces the report (<code>makeHist()</code> in the above example). This can be obtained by altering <code>makeHist()</code> allowing it to take the session object from shiny as an argument, <em>e.g.</em>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">makeHist &lt;-<span class="st"> </span><span class="cf">function</span>(regData, var, bins, ...) {</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  <span class="cf">if</span> (<span class="st">"session"</span> <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(...))) {</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">    raplog<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/raplog/topics/logger">repLogger</a></span>(<span class="dt">session =</span> session, <span class="dt">msg =</span> <span class="st">"Providing histogram"</span>)</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">  ...</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">}</a></code></pre></div>
<p>This will add a record to the report log that looks like:</p>
<pre class="csv"><code>"2019-08-12 13:04:51","ttester","Tore Tester","smerteregisteret","LU",999999,"smerteregisteret","makeHist(df = regData, var = input$var, bins = input$bins, session = session)","Providing histogram"</code></pre>
<p>Changes to the function as suggested above will not alter the way it works in other context since the function only reacts to logging if <code>session</code> is found among its arguments.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/Rapporteket/raplog">https://​github.com/​Rapporteket/​raplog</a>
</li>
<li>Report a bug at <br><a href="https://github.com/Rapporteket/raplog/issues">https://​github.com/​Rapporteket/​raplog/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Are Edvardsen <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-5210-3656" target="orcid.widget"><img src="https://members.orcid.org/sites/default/files/vector_iD_icon.svg" class="orcid" alt="ORCID" height="16"></a> </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/Rapporteket/raplog"><img src="https://travis-ci.org/Rapporteket/raplog.svg?branch=master" alt="Travis build status"></a></li>
<li><a href="https://ci.appveyor.com/project/Rapporteket/raplog"><img src="https://ci.appveyor.com/api/projects/status/github/Rapporteket/raplog?branch=master&amp;svg=true" alt="AppVeyor build status"></a></li>
<li><a href="https://codecov.io/gh/Rapporteket/raplog?branch=master"><img src="https://codecov.io/gh/Rapporteket/raplog/branch/master/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://www.tidyverse.org/lifecycle/#experimental"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
</ul>
</div>
</div>
</div>

      <footer><div class="copyright">
  <p>Developed by Are Edvardsen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
