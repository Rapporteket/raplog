<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Log user events in shiny applications at Rapporteket — logger • raplog</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Log user events in shiny applications at Rapporteket — logger" />
<meta property="og:description" content="To be used for logging at application level (i.e. when a shiny
session is started) or at report level (i.e. each time a report is
run). Logging of single report events should be made from reactive
enviroments within the shiny server function or from within the (report)
functions used by the same reactive environments." />
<meta property="og:image" content="/logo.png" />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">raplog</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/Rapporteket/raplog">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Log user events in shiny applications at Rapporteket</h1>
    <small class="dont-index">Source: <a href='https://github.com/Rapporteket/raplog/blob/master/R/log.R'><code>R/log.R</code></a></small>
    <div class="hidden name"><code>logger.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>To be used for logging at application level (<em>i.e.</em> when a shiny
session is started) or at report level (<em>i.e.</em> each time a report is
run). Logging of single report events should be made from reactive
enviroments within the shiny server function or from within the (report)
functions used by the same reactive environments.</p>
    </div>

    <pre class="usage"><span class='fu'>appLogger</span>(<span class='no'>session</span>, <span class='kw'>msg</span> <span class='kw'>=</span> <span class='st'>"No message provided"</span>)

<span class='fu'>repLogger</span>(<span class='no'>session</span>, <span class='kw'>msg</span> <span class='kw'>=</span> <span class='st'>"No message provided"</span>,
  <span class='kw'>.topcall</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sys.parent.html'>sys.call</a></span>(-<span class='fl'>1</span>), <span class='kw'>.topenv</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sys.parent.html'>parent.frame</a></span>())

<span class='fu'>subLogger</span>(<span class='no'>author</span>, <span class='no'>registryName</span>, <span class='no'>reshId</span>, <span class='kw'>msg</span> <span class='kw'>=</span> <span class='st'>"No message provided"</span>,
  <span class='kw'>.topcall</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sys.parent.html'>sys.call</a></span>(-<span class='fl'>1</span>), <span class='kw'>.topenv</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sys.parent.html'>parent.frame</a></span>())</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>session</th>
      <td><p>Shiny session object to be used for getting user data.
For testing and development purposes <code>session</code> can be replaced by
<code><a href='https://rdrr.io/r/base/list.html'>list()</a></code> in which case various config options might be used to provide
something sensible</p></td>
    </tr>
    <tr>
      <th>msg</th>
      <td><p>String providing a user defined message to be added to the log
record. Default value is 'No message provided'</p></td>
    </tr>
    <tr>
      <th>.topcall</th>
      <td><p>Parent call (if any) calling this function. Used to provide
the function call with arguments. Default value is <code><a href='https://rdrr.io/r/base/sys.parent.html'>sys.call(-1)</a></code></p></td>
    </tr>
    <tr>
      <th>.topenv</th>
      <td><p>Name of the parent environment calling this function. Used to
provide package name (<em>i.e.</em> register) this function was called from.
Default value is <code><a href='https://rdrr.io/r/base/sys.parent.html'>parent.frame()</a></code></p></td>
    </tr>
    <tr>
      <th>author</th>
      <td><p>String providing author of a report. Only used for automated
subscription reports that are run outside a shiny session.</p></td>
    </tr>
    <tr>
      <th>registryName</th>
      <td><p>String providing registry name. Only used for automated
subscription reports that are run outside a shiny session.</p></td>
    </tr>
    <tr>
      <th>reshId</th>
      <td><p>String providing the organization id of the (subscription)
report author. Only used for automated subscription reports that are run
outside a shiny session.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Returns nothing but calls a logging appender</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The below fields will be appended to the log, in the following order:</p><ol>
<li><p><code>time</code>: date-time as event is logged as
<code><a href='https://rdrr.io/r/base/format.html'>format(time, "%Y-%m-%d %H:%M:%S")</a></code></p></li>
<li><p><code>user</code>: username as found in the shiny session object</p></li>
<li><p><code>name</code>: full name of user as found in the shiny session object</p></li>
<li><p><code>group</code>: users group membership as provided by the shiny
session object. Normally, this will correspond to the registry the user
belongs to</p></li>
<li><p><code>role</code>: users role as provided by the shiny session object. Its
value will depend on whatever is delivered by the autorization provider,
but for OpenQReg registires 'LU' (local user) and 'SC' (system
coordinator) are typical values</p></li>
<li><p><code>resh_id</code>: the organization id of the current user as provided
by the shiny session object</p></li>
<li><p><code>environment</code>: environment from where the logger function was
called (only provided by <code>repLogger()</code>)</p></li>
<li><p><code>call</code>: function (with arguments) from where the logger was
called (only provided by <code>repLogger()</code>)</p></li>
<li><p>message: an optional message defined as argument to the function</p></li>
</ol>

    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>Pseudo code of how <code>appLogger()</code> may be implemented:</p><pre>
library(shiny)
library(raplog)

server &lt;- function(input, output, session) {
  raplog::appLogger(session, msg = "Smerteregisteret: starting shiny app")
  ...
}
</pre><p>Pseudo code on how <code>repLogger()</code> can be implemented as part of a
function in a reactive (shiny) context. First, this is an example of the
shiny server function with the (reactive) function <code>renderPlot()</code>
calling a function that provides a histogram:</p><pre>
library(shiny)
library(raplog)

server &lt;- function(input, output, session) {
  ...
  output$hist &lt;- renderPlot({
    makeHist(data, var = input$var, bins = input$bins, session = session)
  })
  ...
}
</pre><p>Then, logging is called within the function <code>makeHist()</code>:</p><pre>
makeHist &lt;- function(data, var, bins, ...) {

  if ("session" %in% names(list(...))) {
    raplog::repLogger(session = list(...)[["session"]], msg = "Providing histogram")
  }
  ...
}
</pre>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># \donttest{</span>
<span class='co'># Depend on the environment variable R_RAP_CONFIG_PATH being set</span>
<span class='fu'>appLogger</span>(<span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>())</div><div class='output co'>#&gt; <span class='message'>System has no defined instance. Configuration as provided by</span>
#&gt; <span class='message'>            'rapbaseConfig.yml' will be used as source for user data.</span></div><div class='output co'>#&gt; <span class='message'>System has no defined instance. Configuration as provided by</span>
#&gt; <span class='message'>            'rapbaseConfig.yml' will be used as source for user data.</span></div><div class='output co'>#&gt; <span class='message'>System has no defined instance. Configuration as provided by</span>
#&gt; <span class='message'>            'rapbaseConfig.yml' will be used as source for user data.</span></div><div class='output co'>#&gt; <span class='message'>System has no defined instance. Configuration as provided by</span>
#&gt; <span class='message'>            'rapbaseConfig.yml' will be used as source for user data.</span></div><div class='output co'>#&gt; <span class='message'>System has no defined instance. Configuration as provided by</span>
#&gt; <span class='message'>            'rapbaseConfig.yml' will be used as source for user data.</span></div><div class='output co'>#&gt; <span class='error'>Error in appendLog(event, name, target = "file", format = "csv"): There is nowhere to append the logging event. The environment variable R_RAP_CONFIG_PATH should be defined!</span></div><div class='input'><span class='co'># }</span>
<span class='co'># \donttest{</span>
<span class='co'># Depend on the environment variable R_RAP_CONFIG_PATH being set</span>
<span class='fu'>repLogger</span>(<span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>())</div><div class='output co'>#&gt; <span class='message'>System has no defined instance. Configuration as provided by</span>
#&gt; <span class='message'>            'rapbaseConfig.yml' will be used as source for user data.</span></div><div class='output co'>#&gt; <span class='message'>System has no defined instance. Configuration as provided by</span>
#&gt; <span class='message'>            'rapbaseConfig.yml' will be used as source for user data.</span></div><div class='output co'>#&gt; <span class='message'>System has no defined instance. Configuration as provided by</span>
#&gt; <span class='message'>            'rapbaseConfig.yml' will be used as source for user data.</span></div><div class='output co'>#&gt; <span class='message'>System has no defined instance. Configuration as provided by</span>
#&gt; <span class='message'>            'rapbaseConfig.yml' will be used as source for user data.</span></div><div class='output co'>#&gt; <span class='message'>System has no defined instance. Configuration as provided by</span>
#&gt; <span class='message'>            'rapbaseConfig.yml' will be used as source for user data.</span></div><div class='output co'>#&gt; <span class='error'>Error in appendLog(event, name, target = "file", format = "csv"): There is nowhere to append the logging event. The environment variable R_RAP_CONFIG_PATH should be defined!</span></div><div class='input'><span class='co'># }</span>
<span class='co'># \donttest{</span>
<span class='co'># Depend on the environment variable R_RAP_CONFIG_PATH being set</span>
<span class='fu'>subLogger</span>(<span class='kw'>author</span> <span class='kw'>=</span> <span class='st'>"Rapporteket"</span>, <span class='kw'>registryName</span> <span class='kw'>=</span> <span class='st'>"rapbase"</span>, <span class='kw'>reshId</span> <span class='kw'>=</span> <span class='st'>"999999"</span>)</div><div class='output co'>#&gt; <span class='error'>Error in appendLog(event, name, target = "file", format = "csv"): There is nowhere to append the logging event. The environment variable R_RAP_CONFIG_PATH should be defined!</span></div><div class='input'># }
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#note">Note</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Are Edvardsen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


